import{N as E,i as U,f as q,b as le,o as h,c as S,w,j as L,L as ge,M as he,k as g,u as e,q as ie,r as _,P as b,m as j,z as D,v as R,t as Q,Q as be,a$ as ke,D as Ee,l as $e,aH as W,E as Z,e as Y,$ as Ce,h as x,ae as _e,p as we,V as Re,aR as ee,A as te}from"./entry.b33cb278.js";import{ElIcon as T}from"./index.960dedfd.js";import{Document as Le,CircleCheck as Pe,Check as Se,Close as Ue,ZoomIn as Fe,Delete as Te}from"./index.dc3cf8fc.js";import{ElProgress as De}from"./index.126f76b0.js";import{t as J,d as Oe}from"./error.6c36bb34.js";import{c as ue}from"./types.bb628c62.js";import{b as N,d as y}from"./runtime.ca6a5e5a.js";import{m as X}from"./typescript.c44ade1c.js";import{_ as A}from"./plugin-vue_export-helper.b0b5f2d9.js";import{u as Be}from"./index.fd65d236.js";import{a as M}from"./use-form-common-props.a25456a0.js";import{e as je}from"./objects.1e9cc2c5.js";import{c as se}from"./cloneDeep.0f109ce3.js";import{i as qe}from"./isEqual.f785ded9.js";import{h as Ne}from"./index.785ddeeb.js";import{w as Ae}from"./install.187cf5b6.js";import"./style.6fe07f58.js";import"./get.070bcf83.js";import"./_baseGet.57648035.js";import"./isArray.3fa80ba1.js";import"./isObject.5a18b265.js";import"./constants.e2ce9b61.js";import"./index.3ddc1a68.js";import"./size.007424cf.js";import"./_baseSet.39436bc7.js";import"./_defineProperty.f71786e5.js";import"./_isIndex.f5af1eca.js";import"./_baseClone.00ccee08.js";import"./_Uint8Array.4a2b558d.js";import"./_arrayPush.6d7e61e4.js";import"./_initCloneObject.90ccc272.js";const de=Symbol("uploadContextKey"),Me="ElUpload";class He extends Error{constructor(l,s,n,c){super(l),this.name="UploadAjaxError",this.status=s,this.method=n,this.url=c}}function ae(o,l,s){let n;return s.response?n=`${s.response.error||s.response}`:s.responseText?n=`${s.responseText}`:n=`fail to ${l.method} ${o} ${s.status}`,new He(n,s.status,l.method,o)}function Ke(o){const l=o.responseText||o.response;if(!l)return l;try{return JSON.parse(l)}catch{return l}}const ze=o=>{typeof XMLHttpRequest>"u"&&J(Me,"XMLHttpRequest is undefined");const l=new XMLHttpRequest,s=o.action;l.upload&&l.upload.addEventListener("progress",p=>{const f=p;f.percent=p.total>0?p.loaded/p.total*100:0,o.onProgress(f)});const n=new FormData;if(o.data)for(const[p,f]of Object.entries(o.data))Array.isArray(f)?n.append(p,...f):n.append(p,f);n.append(o.filename,o.file,o.file.name),l.addEventListener("error",()=>{o.onError(ae(s,o,l))}),l.addEventListener("load",()=>{if(l.status<200||l.status>=300)return o.onError(ae(s,o,l));o.onSuccess(Ke(l))}),l.open(o.method,s,!0),o.withCredentials&&"withCredentials"in l&&(l.withCredentials=!0);const c=o.headers||{};if(c instanceof Headers)c.forEach((p,f)=>l.setRequestHeader(f,p));else for(const[p,f]of Object.entries(c))ue(f)||l.setRequestHeader(p,String(f));return l.send(n),l},ce=["text","picture","picture-card"];let Ie=1;const G=()=>Date.now()+Ie++,pe=N({action:{type:String,default:"#"},headers:{type:y(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>X({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:y(Array),default:()=>X([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ce,default:"text"},httpRequest:{type:y(Function),default:ze},disabled:Boolean,limit:Number}),Ve=N({...pe,beforeUpload:{type:y(Function),default:E},beforeRemove:{type:y(Function)},onRemove:{type:y(Function),default:E},onChange:{type:y(Function),default:E},onPreview:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}}),We=N({files:{type:y(Array),default:()=>X([])},disabled:{type:Boolean,default:!1},handlePreview:{type:y(Function),default:E},listType:{type:String,values:ce,default:"text"}}),Xe={remove:o=>!!o},Ge=["onKeydown"],Je=["src"],Qe=["onClick"],Ze=["title"],Ye=["onClick"],xe=["onClick"],et=U({name:"ElUploadList"}),tt=U({...et,props:We,emits:Xe,setup(o,{emit:l}){const{t:s}=Be(),n=q("upload"),c=q("icon"),p=q("list"),f=M(),C=le(!1),$=d=>{l("remove",d)};return(d,k)=>(h(),S(ke,{tag:"ul",class:g([e(n).b("list"),e(n).bm("list",d.listType),e(n).is("disabled",e(f))]),name:e(p).b()},{default:w(()=>[(h(!0),L(ge,null,he(d.files,m=>(h(),L("li",{key:m.uid||m.name,class:g([e(n).be("list","item"),e(n).is(m.status),{focusing:C.value}]),tabindex:"0",onKeydown:ie(a=>!e(f)&&$(m),["delete"]),onFocus:k[0]||(k[0]=a=>C.value=!0),onBlur:k[1]||(k[1]=a=>C.value=!1),onClick:k[2]||(k[2]=a=>C.value=!1)},[_(d.$slots,"default",{file:m},()=>[d.listType==="picture"||m.status!=="uploading"&&d.listType==="picture-card"?(h(),L("img",{key:0,class:g(e(n).be("list","item-thumbnail")),src:m.url,alt:""},null,10,Je)):b("v-if",!0),m.status==="uploading"||d.listType!=="picture-card"?(h(),L("div",{key:1,class:g(e(n).be("list","item-info"))},[j("a",{class:g(e(n).be("list","item-name")),onClick:D(a=>d.handlePreview(m),["prevent"])},[R(e(T),{class:g(e(c).m("document"))},{default:w(()=>[R(e(Le))]),_:1},8,["class"]),j("span",{class:g(e(n).be("list","item-file-name")),title:m.name},Q(m.name),11,Ze)],10,Qe),m.status==="uploading"?(h(),S(e(De),{key:0,type:d.listType==="picture-card"?"circle":"line","stroke-width":d.listType==="picture-card"?6:2,percentage:Number(m.percentage),style:be(d.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):b("v-if",!0)],2)):b("v-if",!0),j("label",{class:g(e(n).be("list","item-status-label"))},[d.listType==="text"?(h(),S(e(T),{key:0,class:g([e(c).m("upload-success"),e(c).m("circle-check")])},{default:w(()=>[R(e(Pe))]),_:1},8,["class"])):["picture-card","picture"].includes(d.listType)?(h(),S(e(T),{key:1,class:g([e(c).m("upload-success"),e(c).m("check")])},{default:w(()=>[R(e(Se))]),_:1},8,["class"])):b("v-if",!0)],2),e(f)?b("v-if",!0):(h(),S(e(T),{key:2,class:g(e(c).m("close")),onClick:a=>$(m)},{default:w(()=>[R(e(Ue))]),_:2},1032,["class","onClick"])),b(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),b(" This is a bug which needs to be fixed "),b(" TODO: Fix the incorrect navigation interaction "),e(f)?b("v-if",!0):(h(),L("i",{key:3,class:g(e(c).m("close-tip"))},Q(e(s)("el.upload.deleteTip")),3)),d.listType==="picture-card"?(h(),L("span",{key:4,class:g(e(n).be("list","item-actions"))},[j("span",{class:g(e(n).be("list","item-preview")),onClick:a=>d.handlePreview(m)},[R(e(T),{class:g(e(c).m("zoom-in"))},{default:w(()=>[R(e(Fe))]),_:1},8,["class"])],10,Ye),e(f)?b("v-if",!0):(h(),L("span",{key:0,class:g(e(n).be("list","item-delete")),onClick:a=>$(m)},[R(e(T),{class:g(e(c).m("delete"))},{default:w(()=>[R(e(Te))]),_:1},8,["class"])],10,xe))],2)):b("v-if",!0)])],42,Ge))),128)),_(d.$slots,"append")]),_:3},8,["class","name"]))}});var oe=A(tt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const st=N({disabled:{type:Boolean,default:!1}}),at={file:o=>Ee(o)},ot=["onDrop","onDragover"],fe="ElUploadDrag",nt=U({name:fe}),rt=U({...nt,props:st,emits:at,setup(o,{emit:l}){const s=$e(de);s||J(fe,"usage: <el-upload><el-upload-dragger /></el-upload>");const n=q("upload"),c=le(!1),p=M(),f=$=>{if(p.value)return;c.value=!1,$.stopPropagation();const d=Array.from($.dataTransfer.files),k=s.accept.value;if(!k){l("file",d);return}const m=d.filter(a=>{const{type:i,name:t}=a,u=t.includes(".")?`.${t.split(".").pop()}`:"",v=i.replace(/\/.*$/,"");return k.split(",").map(r=>r.trim()).filter(r=>r).some(r=>r.startsWith(".")?u===r:/\/\*$/.test(r)?v===r.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(r)?i===r:!1)});l("file",m)},C=()=>{p.value||(c.value=!0)};return($,d)=>(h(),L("div",{class:g([e(n).b("dragger"),e(n).is("dragover",c.value)]),onDrop:D(f,["prevent"]),onDragover:D(C,["prevent"]),onDragleave:d[0]||(d[0]=D(k=>c.value=!1,["prevent"]))},[_($.$slots,"default")],42,ot))}});var lt=A(rt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const it=N({...pe,beforeUpload:{type:y(Function),default:E},onRemove:{type:y(Function),default:E},onStart:{type:y(Function),default:E},onSuccess:{type:y(Function),default:E},onProgress:{type:y(Function),default:E},onError:{type:y(Function),default:E},onExceed:{type:y(Function),default:E}}),ut=["onKeydown"],dt=["name","multiple","accept"],ct=U({name:"ElUploadContent",inheritAttrs:!1}),pt=U({...ct,props:it,setup(o,{expose:l}){const s=o,n=q("upload"),c=M(),p=W({}),f=W(),C=t=>{if(t.length===0)return;const{autoUpload:u,limit:v,fileList:r,multiple:F,onStart:P,onExceed:H}=s;if(v&&r.length+t.length>v){H(t,r);return}F||(t=t.slice(0,1));for(const K of t){const O=K;O.uid=G(),P(O),u&&$(O)}},$=async t=>{if(f.value.value="",!s.beforeUpload)return d(t);let u,v={};try{const F=s.data,P=s.beforeUpload(t);v=Z(s.data)?se(s.data):s.data,u=await P,Z(s.data)&&qe(F,v)&&(v=se(s.data))}catch{u=!1}if(u===!1){s.onRemove(t);return}let r=t;u instanceof Blob&&(u instanceof File?r=u:r=new File([u],t.name,{type:t.type})),d(Object.assign(r,{uid:t.uid}),v)},d=(t,u)=>{const{headers:v,data:r,method:F,withCredentials:P,name:H,action:K,onProgress:O,onSuccess:me,onError:ve,httpRequest:ye}=s,{uid:z}=t,I={headers:v||{},withCredentials:P,file:t,data:u!=null?u:r,method:F,filename:H,action:K,onProgress:B=>{O(B,t)},onSuccess:B=>{me(B,t),delete p.value[z]},onError:B=>{ve(B,t),delete p.value[z]}},V=ye(I);p.value[z]=V,V instanceof Promise&&V.then(I.onSuccess,I.onError)},k=t=>{const u=t.target.files;!u||C(Array.from(u))},m=()=>{c.value||(f.value.value="",f.value.click())},a=()=>{m()};return l({abort:t=>{je(p.value).filter(t?([v])=>String(t.uid)===v:()=>!0).forEach(([v,r])=>{r instanceof XMLHttpRequest&&r.abort(),delete p.value[v]})},upload:$}),(t,u)=>(h(),L("div",{class:g([e(n).b(),e(n).m(t.listType),e(n).is("drag",t.drag)]),tabindex:"0",onClick:m,onKeydown:ie(D(a,["self"]),["enter","space"])},[t.drag?(h(),S(lt,{key:0,disabled:e(c),onFile:C},{default:w(()=>[_(t.$slots,"default")]),_:3},8,["disabled"])):_(t.$slots,"default",{key:1}),j("input",{ref_key:"inputRef",ref:f,class:g(e(n).e("input")),name:t.name,multiple:t.multiple,accept:t.accept,type:"file",onChange:k,onClick:u[0]||(u[0]=D(()=>{},["stop"]))},null,42,dt)],42,ut))}});var ne=A(pt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const re="ElUpload",ft=o=>{var l;(l=o.url)!=null&&l.startsWith("blob:")&&URL.revokeObjectURL(o.url)},mt=(o,l)=>{const s=Ne(o,"fileList",void 0,{passive:!0}),n=a=>s.value.find(i=>i.uid===a.uid);function c(a){var i;(i=l.value)==null||i.abort(a)}function p(a=["ready","uploading","success","fail"]){s.value=s.value.filter(i=>!a.includes(i.status))}const f=(a,i)=>{const t=n(i);!t||(console.error(a),t.status="fail",s.value.splice(s.value.indexOf(t),1),o.onError(a,t,s.value),o.onChange(t,s.value))},C=(a,i)=>{const t=n(i);!t||(o.onProgress(a,t,s.value),t.status="uploading",t.percentage=Math.round(a.percent))},$=(a,i)=>{const t=n(i);!t||(t.status="success",t.response=a,o.onSuccess(a,t,s.value),o.onChange(t,s.value))},d=a=>{ue(a.uid)&&(a.uid=G());const i={name:a.name,percentage:0,status:"ready",size:a.size,raw:a,uid:a.uid};if(o.listType==="picture-card"||o.listType==="picture")try{i.url=URL.createObjectURL(a)}catch(t){Oe(re,t.message),o.onError(t,i,s.value)}s.value=[...s.value,i],o.onChange(i,s.value)},k=async a=>{const i=a instanceof File?n(a):a;i||J(re,"file to be removed not found");const t=u=>{c(u);const v=s.value;v.splice(v.indexOf(u),1),o.onRemove(u,v),ft(u)};o.beforeRemove?await o.beforeRemove(i,s.value)!==!1&&t(i):t(i)};function m(){s.value.filter(({status:a})=>a==="ready").forEach(({raw:a})=>{var i;return a&&((i=l.value)==null?void 0:i.upload(a))})}return Y(()=>o.listType,a=>{a!=="picture-card"&&a!=="picture"||(s.value=s.value.map(i=>{const{raw:t,url:u}=i;if(!u&&t)try{i.url=URL.createObjectURL(t)}catch(v){o.onError(v,i,s.value)}return i}))}),Y(s,a=>{for(const i of a)i.uid||(i.uid=G()),i.status||(i.status="success")},{immediate:!0,deep:!0}),{uploadFiles:s,abort:c,clearFiles:p,handleError:f,handleProgress:C,handleStart:d,handleSuccess:$,handleRemove:k,submit:m}},vt=U({name:"ElUpload"}),yt=U({...vt,props:Ve,setup(o,{expose:l}){const s=o,n=Ce(),c=M(),p=W(),{abort:f,submit:C,clearFiles:$,uploadFiles:d,handleStart:k,handleError:m,handleRemove:a,handleSuccess:i,handleProgress:t}=mt(s,p),u=x(()=>s.listType==="picture-card"),v=x(()=>({...s,fileList:d.value,onStart:k,onProgress:t,onSuccess:i,onError:m,onRemove:a}));return _e(()=>{d.value.forEach(({url:r})=>{r!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(r)})}),we(de,{accept:Re(s,"accept")}),l({abort:f,submit:C,clearFiles:$,handleStart:k,handleRemove:a}),(r,F)=>(h(),L("div",null,[e(u)&&r.showFileList?(h(),S(oe,{key:0,disabled:e(c),"list-type":r.listType,files:e(d),"handle-preview":r.onPreview,onRemove:e(a)},ee({append:w(()=>[R(ne,te({ref_key:"uploadRef",ref:p},e(v)),{default:w(()=>[e(n).trigger?_(r.$slots,"trigger",{key:0}):b("v-if",!0),!e(n).trigger&&e(n).default?_(r.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)]),_:2},[r.$slots.file?{name:"default",fn:w(({file:P})=>[_(r.$slots,"file",{file:P})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0),!e(u)||e(u)&&!r.showFileList?(h(),S(ne,te({key:1,ref_key:"uploadRef",ref:p},e(v)),{default:w(()=>[e(n).trigger?_(r.$slots,"trigger",{key:0}):b("v-if",!0),!e(n).trigger&&e(n).default?_(r.$slots,"default",{key:1}):b("v-if",!0)]),_:3},16)):b("v-if",!0),r.$slots.trigger?_(r.$slots,"default",{key:2}):b("v-if",!0),_(r.$slots,"tip"),!e(u)&&r.showFileList?(h(),S(oe,{key:3,disabled:e(c),"list-type":r.listType,files:e(d),"handle-preview":r.onPreview,onRemove:e(a)},ee({_:2},[r.$slots.file?{name:"default",fn:w(({file:P})=>[_(r.$slots,"file",{file:P})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):b("v-if",!0)]))}});var gt=A(yt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Jt=Ae(gt);export{Jt as ElUpload,Jt as default,G as genFileId,pe as uploadBaseProps,it as uploadContentProps,de as uploadContextKey,at as uploadDraggerEmits,st as uploadDraggerProps,Xe as uploadListEmits,We as uploadListProps,ce as uploadListTypes,Ve as uploadProps};
