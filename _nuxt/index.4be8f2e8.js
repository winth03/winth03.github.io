import{ad as ve,a8 as D,aa as ge,f as x,aI as he,a2 as be,p as c,k as y,H as ye,o as $,c as we,L as d,I as G,a4 as A,u as t,R as Q,S as I,D as V,X as Ee,W as Se,K as w,U as $e,Q as Ae,a6 as Ie,aQ as E,aK as j,aR as ke,e as Te,as as P}from"./entry.40f94ce2.js";import{o as Ce}from"./index.5dbd068b.js";import{Loading as Ne}from"./index.e0b44930.js";import{ElInput as _e}from"./index.ecd8b7b6.js";import{ElScrollbar as Be}from"./index.8ce59d4c.js";import{u as Fe,E as De}from"./index.0becfcd2.js";import{ElIcon as Ve}from"./index.52232a07.js";import{b as Pe,d as X}from"./runtime.a8d5aa72.js";import{U as k,I as K,C as J}from"./event.e54e7e4a.js";import{_ as Ke}from"./plugin-vue_export-helper.b0b5f2d9.js";import{u as Oe}from"./index.43dcf301.js";import{a as Re}from"./use-form-common-props.c0d2009e.js";import{g as Le}from"./rand.0e47716b.js";import{t as We}from"./error.6c36bb34.js";import{d as Me}from"./debounce.a43f57fe.js";import{w as Ue}from"./install.db378abc.js";import"./browser.d39506a1.js";import"./types.0ffe2429.js";import"./index.f72caa6f.js";import"./size.007424cf.js";import"./icon.aaa9d058.js";import"./typescript.c44ade1c.js";import"./use-form-item.eeb4683c.js";import"./constants.e2ce9b61.js";import"./i18n.de31208d.js";import"./util.c8753e63.js";import"./style.a7bf22e4.js";import"./index.cd7da693.js";import"./index.1eb5ee59.js";import"./focus-trap.efed23b5.js";import"./aria.362daa0e.js";import"./event.079378dc.js";import"./isObject.5a18b265.js";const He=Pe({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:X(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:X([Function,Array]),default:ve},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},label:{type:String},teleported:Fe.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String}),qe={[k]:s=>D(s),[K]:s=>D(s),[J]:s=>D(s),focus:s=>s instanceof FocusEvent,blur:s=>s instanceof FocusEvent,clear:()=>!0,select:s=>ge(s)},ze=["aria-expanded","aria-owns"],Ge={key:0},Qe=["id","aria-selected","onClick"],Y="ElAutocomplete",je=x({name:Y,inheritAttrs:!1}),Xe=x({...je,props:He,emits:qe,setup(s,{expose:Z,emit:i}){const l=s,ee=Oe(),te=he(),O=Re(),u=be("autocomplete"),n=c(),R=c(),T=c(),L=c();let W=!1,C=!1;const p=c([]),o=c(-1),M=c(""),f=c(!1),S=c(!1),v=c(!1),h=y(()=>u.b(String(Le()))),ae=y(()=>te.style),m=y(()=>(p.value.length>0||v.value)&&f.value),U=y(()=>!l.hideLoading&&v.value),oe=y(()=>n.value?Array.from(n.value.$el.querySelectorAll("input")):[]),se=async()=>{await Te(),m.value&&(M.value=`${n.value.$el.offsetWidth}px`)},le=()=>{o.value=-1},H=Me(async e=>{if(S.value)return;const a=r=>{v.value=!1,!S.value&&(P(r)?(p.value=r,o.value=l.highlightFirstItem?0:-1):We(Y,"autocomplete suggestions must be an array"))};if(v.value=!0,P(l.fetchSuggestions))a(l.fetchSuggestions);else{const r=await l.fetchSuggestions(e,a);P(r)&&a(r)}},l.debounce),ne=e=>{const a=!!e;if(i(K,e),i(k,e),S.value=!1,f.value||(f.value=a),!l.triggerOnFocus&&!e){S.value=!0,p.value=[];return}H(e)},re=e=>{var a;O.value||(((a=e.target)==null?void 0:a.tagName)!=="INPUT"||oe.value.includes(document.activeElement))&&(f.value=!0)},ie=e=>{i(J,e)},ue=e=>{C?C=!1:(f.value=!0,i("focus",e),l.triggerOnFocus&&!W&&H(String(l.modelValue)))},pe=e=>{setTimeout(()=>{var a;if((a=T.value)!=null&&a.isFocusInsideContent()){C=!0;return}f.value&&b(),i("blur",e)})},ce=()=>{f.value=!1,i(k,""),i("clear")},q=async()=>{m.value&&o.value>=0&&o.value<p.value.length?N(p.value[o.value]):l.selectWhenUnmatched&&(i("select",{value:l.modelValue}),p.value=[],o.value=-1)},fe=e=>{m.value&&(e.preventDefault(),e.stopPropagation(),b())},b=()=>{f.value=!1},de=()=>{var e;(e=n.value)==null||e.focus()},me=()=>{var e;(e=n.value)==null||e.blur()},N=async e=>{i(K,e[l.valueKey]),i(k,e[l.valueKey]),i("select",e),p.value=[],o.value=-1},_=e=>{if(!m.value||v.value)return;if(e<0){o.value=-1;return}e>=p.value.length&&(e=p.value.length-1);const a=R.value.querySelector(`.${u.be("suggestion","wrap")}`),g=a.querySelectorAll(`.${u.be("suggestion","list")} li`)[e],B=a.scrollTop,{offsetTop:z,scrollHeight:F}=g;z+F>B+a.clientHeight&&(a.scrollTop+=F),z<B&&(a.scrollTop-=F),o.value=e,n.value.ref.setAttribute("aria-activedescendant",`${h.value}-item-${o.value}`)};return Ce(L,()=>{m.value&&b()}),ye(()=>{n.value.ref.setAttribute("role","textbox"),n.value.ref.setAttribute("aria-autocomplete","list"),n.value.ref.setAttribute("aria-controls","id"),n.value.ref.setAttribute("aria-activedescendant",`${h.value}-item-${o.value}`),W=n.value.ref.hasAttribute("readonly")}),Z({highlightedIndex:o,activated:f,loading:v,inputRef:n,popperRef:T,suggestions:p,handleSelect:N,handleKeyEnter:q,focus:de,blur:me,close:b,highlight:_}),(e,a)=>($(),we(t(De),{ref_key:"popperRef",ref:T,visible:t(m),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[t(u).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${t(u).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:se,onHide:le},{content:d(()=>[G("div",{ref_key:"regionRef",ref:R,class:A([t(u).b("suggestion"),t(u).is("loading",t(U))]),style:Q({[e.fitInputWidth?"width":"minWidth"]:M.value,outline:"none"}),role:"region"},[I(t(Be),{id:t(h),tag:"ul","wrap-class":t(u).be("suggestion","wrap"),"view-class":t(u).be("suggestion","list"),role:"listbox"},{default:d(()=>[t(U)?($(),V("li",Ge,[I(t(Ve),{class:A(t(u).is("loading"))},{default:d(()=>[I(t(Ne))]),_:1},8,["class"])])):($(!0),V(Ee,{key:1},Se(p.value,(r,g)=>($(),V("li",{id:`${t(h)}-item-${g}`,key:g,class:A({highlighted:o.value===g}),role:"option","aria-selected":o.value===g,onClick:B=>N(r)},[w(e.$slots,"default",{item:r},()=>[$e(Ae(r[e.valueKey]),1)])],10,Qe))),128))]),_:3},8,["id","wrap-class","view-class"])],6)]),default:d(()=>[G("div",{ref_key:"listboxRef",ref:L,class:A([t(u).b(),e.$attrs.class]),style:Q(t(ae)),role:"combobox","aria-haspopup":"listbox","aria-expanded":t(m),"aria-owns":t(h)},[I(t(_e),Ie({ref_key:"inputRef",ref:n},t(ee),{clearable:e.clearable,disabled:t(O),name:e.name,"model-value":e.modelValue,onInput:ne,onChange:ie,onFocus:ue,onBlur:pe,onClear:ce,onKeydown:[a[0]||(a[0]=E(j(r=>_(o.value-1),["prevent"]),["up"])),a[1]||(a[1]=E(j(r=>_(o.value+1),["prevent"]),["down"])),E(q,["enter"]),E(b,["tab"]),E(fe,["esc"])],onMousedown:re}),ke({_:2},[e.$slots.prepend?{name:"prepend",fn:d(()=>[w(e.$slots,"prepend")])}:void 0,e.$slots.append?{name:"append",fn:d(()=>[w(e.$slots,"append")])}:void 0,e.$slots.prefix?{name:"prefix",fn:d(()=>[w(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:d(()=>[w(e.$slots,"suffix")])}:void 0]),1040,["clearable","disabled","name","model-value","onKeydown"])],14,ze)]),_:3},8,["visible","placement","popper-class","teleported","transition"]))}});var xe=Ke(Xe,[["__file","/home/runner/work/element-plus/element-plus/packages/components/autocomplete/src/autocomplete.vue"]]);const Bt=Ue(xe);export{Bt as ElAutocomplete,qe as autocompleteEmits,He as autocompleteProps,Bt as default};
